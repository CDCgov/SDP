apiVersion: v1
kind: Template
labels:
  template: es-deployer-template
metadata:
  annotations:
    description: Template for running the elasticsearch deployer in a pod. Requires
      empowered 'es-deployer' service account.  Deploys an ES cluster with desired
      number of nodes.
    iconClass: icon-elastic
    openshift.io/display-name: "ElasticSearch Deployer"
    tags: database,elastic
  creationTimestamp: null
  name: es-deployer-template
message: "Your elasticsearch cluster has been created"
objects:
- apiVersion: v1
  kind: Pod
  metadata:
    generateName: es-deployer-
  spec:
    containers:
    - env:
      - name: PROJECT
        valueFrom:
          fieldRef:
            fieldPath: metadata.namespace
      - name: IMAGE_PREFIX
        value: ${IMAGE_PREFIX}
      - name: IMAGE_VERSION
        value: ${IMAGE_VERSION}
      - name: IMAGE_PULL_SECRET
        value: ${IMAGE_PULL_SECRET}
      - name: INSECURE_REGISTRY
        value: ${INSECURE_REGISTRY}
      - name: PUBLIC_MASTER_URL
        value: ${PUBLIC_MASTER_URL}
      - name: MASTER_URL
        value: ${MASTER_URL}
      - name: ES_INSTANCE_RAM
        value: ${ES_INSTANCE_RAM}
      - name: ES_PVC_SIZE
        value: ${ES_PVC_SIZE}
      - name: ES_PVC_PREFIX
        value: ${ES_PVC_PREFIX}
      - name: ES_PVC_DYNAMIC
        value: ${ES_PVC_DYNAMIC}
      - name: ES_CLUSTER_SIZE
        value: ${ES_CLUSTER_SIZE}
      - name: ES_NODE_QUORUM
        value: ${ES_NODE_QUORUM}
      - name: ES_RECOVER_AFTER_NODES
        value: ${ES_RECOVER_AFTER_NODES}
      - name: ES_RECOVER_EXPECTED_NODES
        value: ${ES_RECOVER_EXPECTED_NODES}
      - name: ES_RECOVER_AFTER_TIME
        value: ${ES_RECOVER_AFTER_TIME}
      - name: ES_NODESELECTOR
        value: ${ES_NODESELECTOR}
      - name: MODE
        value: ${MODE}
      image: ${IMAGE_PREFIX}es-deployer:${IMAGE_VERSION}
      imagePullPolicy: Always
      name: deployer
      volumeMounts:
      - mountPath: /etc/deploy
        name: empty
    dnsPolicy: ClusterFirst
    restartPolicy: Never
    serviceAccount: es-deployer
    volumes:
    - emptyDir: {}
      name: empty
parameters:
- description: The mode that the deployer runs in.
  name: MODE
  value: install
- description: Specify prefix for ES components; e.g. for "openshift/origin-es-deployer:v1.1",
    set prefix "openshift/origin-"
  name: IMAGE_PREFIX
  value: {{docker_registry_addr}}:5000/openshift/origin-
- description: Specify version for logging components; e.g. for "openshift/origin-logging-deployer:v1.1",
    set version "v1.1"
  name: IMAGE_VERSION
  value: latest
- description: (Deprecated) Specify the name of an existing pull secret to be used
    for pulling component images from an authenticated registry.
  name: IMAGE_PULL_SECRET
- description: (Deprecated) Allow the registry for ES component images to be
    non-secure (not secured with a certificate signed by a known CA)
  name: INSECURE_REGISTRY
  value: "false"
- description: (Deprecated) External URL for the master, for OAuth purposes
  name: PUBLIC_MASTER_URL
  value: https://localhost:8443
- description: (Deprecated) Internal URL for the master, for authentication retrieval
  name: MASTER_URL
  value: https://kubernetes.default.svc.cluster.local
- description: (Deprecated) How many instances of ElasticSearch to deploy.
  name: ES_CLUSTER_SIZE
  value: "1"
- description: (Deprecated) Amount of RAM to reserve per ElasticSearch instance.
  name: ES_INSTANCE_RAM
  value: 8G
- description: (Deprecated) Size of the PersistentVolumeClaim to create per ElasticSearch
    instance, e.g. 100G. If empty, no PVCs will be created and emptyDir volumes are
    used instead.
  name: ES_PVC_SIZE
- description: (Deprecated) Prefix for the names of PersistentVolumeClaims to be created;
    a number will be appended per instance. If they don't already exist, they will
    be created with size ES_PVC_SIZE.
  name: ES_PVC_PREFIX
  value: es-
- description: '(Deprecated) Set to "true" to request dynamic provisioning (if enabled
    for your cluster) of a PersistentVolume for the ES PVC. '
  name: ES_PVC_DYNAMIC
- description: (Deprecated) Number of nodes required to elect a master (ES minimum_master_nodes).
    By default, derived from ES_CLUSTER_SIZE / 2 + 1.
  name: ES_NODE_QUORUM
- description: (Deprecated) Number of nodes required to be present before the cluster
    will recover from a full restart. By default, one fewer than ES_CLUSTER_SIZE.
  name: ES_RECOVER_AFTER_NODES
- description: (Deprecated) Number of nodes desired to be present before the cluster
    will recover from a full restart. By default, ES_CLUSTER_SIZE.
  name: ES_RECOVER_EXPECTED_NODES
- description: (Deprecated) Timeout for *expected* nodes to be present when cluster
    is recovering from a full restart.
  name: ES_RECOVER_AFTER_TIME
  value: 5m
- description: (Deprecated) Node selector used for Elasticsearch cluster (label=value).
  name: ES_NODESELECTOR
